---
- name: Ensure public files directory is writable by Nginx http server
# After we rsync from prod we get ssh'd (remote) rsyncer's ownership
  file:
    path: "{{ drupal_core_path }}/sites/default/files/"
    recurse: yes
    state: directory
    owner: www-data
    group: www-data
    mode: ug+w,g+s
  become: yes
  tags: ['drupal', 'prod_only']

- name: Ensure private files directory is writable by Nginx http server
# After we rsync from prod we get ssh'd (remote) rsyncer's ownership
  file:
    path: "{{ drupal_core_path }}/sites/default/files/private"
    recurse: yes
    state: directory
    owner: www-data
    group: www-data
    mode: ug+w,g+s
  become: yes
  tags: ['drupal', 'prod_only']

- name: Ensure tmp directory is writable by Nginx http server
  file:
    path: "{{ drupal_core_path }}/../tmp"
    recurse: yes
    state: directory
    owner: www-data
    group: www-data
    mode: ug+w,g+s
  become: yes
  tags: ['drupal', 'prod_only']

- name: Ensure config directory is writable by Nginx http server
  file:
    path: "{{ drupal_core_path }}/../config"
    recurse: yes
    state: directory
    owner: "{{ ansible_ssh_user }}"
    group: www-data
    mode: ug+w
  become: yes
  tags: ['drupal', 'prod_only']
